<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Raw Top Down Shooter</title>

<style>
html,body{
  margin:0;padding:0;background:#000;overflow:hidden;
  touch-action:none;font-family:system-ui;
}
canvas{display:block}

/* SHOP */
#shop{
  position:fixed;top:10px;right:10px;
  background:rgba(0,0,0,.8);color:#fff;
  padding:8px;font-size:14px;z-index:10;
}
#shop button{width:100%;margin-top:6px}

/* GUN ICONS */
#guns{
  position:fixed;
  top:50%;
  left:10px;
  transform:translateY(-50%);
  display:flex;
  flex-direction:column;
  gap:8px;
  z-index:10;
}
.gunIcon{
  width:48px;height:48px;
  background:#333;
  border:2px solid #666;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:10px;
}
.gunIcon.locked{opacity:.3}
.gunIcon.active{border-color:#0af}

/* JOYSTICKS */
.joy{
  position:fixed;bottom:30px;
  width:120px;height:120px;
  border-radius:50%;
  background:rgba(255,255,255,.15);
}
.stick{
  position:absolute;left:40px;top:40px;
  width:40px;height:40px;
  border-radius:50%;background:#ccc;
}
#moveJoy{left:30px}
#aimJoy{right:160px}
</style>
</head>

<body>

<div id="shop">
<b>SHOP</b><br>
Kills: <span id="kills">0</span><br>
<button onclick="buy(1)">SMG (5)</button>
<button onclick="buy(2)">Shotgun (10)</button>
<button onclick="buy(3)">Joke Gun (3)</button>
</div>

<div id="guns"></div>

<div id="moveJoy" class="joy"><div class="stick"></div></div>
<div id="aimJoy" class="joy"><div class="stick"></div></div>

<canvas id="game"></canvas>

<script>
/* ===== CORE ===== */
const c=game,x=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener("resize",resize);

/* ===== AUDIO ===== */
const A=new (window.AudioContext||webkitAudioContext)();
function snd(f,d){
  let o=A.createOscillator(),g=A.createGain();
  o.frequency.value=f;o.connect(g);g.connect(A.destination);
  g.gain.value=.15;o.start();o.stop(A.currentTime+d);
}

/* ===== PLAYER ===== */
const P={x:0,y:0,a:0,s:2.4,k:0};

/* ===== WEAPONS ===== */
const W=[
 {name:"Pistol",d:40,r:180,l:28,u:1},
 {name:"SMG",d:15,r:90,l:34,u:0},
 {name:"Shotgun",d:70,r:500,l:30,u:0},
 {name:"Joke",d:5,r:60,l:40,u:0} // JOKE GUN
];
let CW=0,recoil=0;

/* ===== ENEMIES ===== */
const enemies=[];
function newRoom(){
  enemies.length=0;
  for(let i=0;i<6+Math.random()*4;i++)
    enemies.push({x:Math.random()*c.width,y:Math.random()*c.height,hp:40,s:.6});
  P.x=c.width/2;P.y=c.height/2;
}
newRoom();

/* ===== UI: GUN ICONS ===== */
const gunsDiv=document.getElementById("guns");
function renderGunIcons(){
  gunsDiv.innerHTML="";
  W.forEach((w,i)=>{
    const d=document.createElement("div");
    d.className="gunIcon"+(w.u?"":" locked")+(i===CW?" active":"");
    d.textContent=w.name;
    d.onclick=()=>{
      if(!w.u)return;
      CW=i;
      renderGunIcons();
    };
    gunsDiv.appendChild(d);
  });
}
renderGunIcons();

/* ===== INPUT ===== */
let mv={x:0,y:0},aim={x:1,y:0},shoot=0;

/* joysticks */
function joy(el,cb){
  const s=el.querySelector(".stick");
  el.addEventListener("touchmove",e=>{
    const r=el.getBoundingClientRect(),t=e.touches[0];
    let dx=t.clientX-r.left-60,dy=t.clientY-r.top-60;
    let d=Math.hypot(dx,dy)||1;
    if(d>40){dx*=40/d;dy*=40/d}
    s.style.transform=`translate(${dx}px,${dy}px)`;
    cb(dx/40,dy/40);
  });
  el.addEventListener("touchend",()=>{
    s.style.transform="translate(0,0)";
    cb(0,0);
  });
}
joy(moveJoy,(x,y)=>{mv.x=x;mv.y=y});
joy(aimJoy,(x,y)=>{if(x||y){aim.x=x;aim.y=y;P.a=Math.atan2(y,x)}});

/* shoot */
addEventListener("touchstart",e=>{
  if(e.target.classList.contains("stick"))return;
  shoot=1;fire();
});
addEventListener("touchend",()=>shoot=0);

/* ===== FIRE ===== */
function fire(){
  if(!shoot)return;
  recoil=6;
  snd(W[CW].name==="Joke"?220:420,.05);

  enemies.forEach((e,i)=>{
    let dx=e.x-P.x,dy=e.y-P.y;
    let dist=Math.hypot(dx,dy);
    let a=Math.atan2(dy,dx);
    let diff=Math.abs(Math.atan2(Math.sin(a-P.a),Math.cos(a-P.a)));
    if(dist<180&&diff<.35){
      e.hp-=W[CW].d;
      if(e.hp<=0){
        enemies.splice(i,1);
        P.k++;snd(900,.08);
        if(!enemies.length)newRoom();
      }
    }
  });

  setTimeout(()=>shoot&&fire(),W[CW].r);
}

/* ===== SHOP ===== */
function buy(i){
  const cost=[0,5,10,3][i];
  if(W[i].u||P.k<cost)return;
  P.k-=cost;W[i].u=1;CW=i;
  renderGunIcons();
}

/* ===== LOOP ===== */
(function loop(){
  P.x+=mv.x*P.s;P.y+=mv.y*P.s;
  enemies.forEach(e=>{
    let dx=P.x-e.x,dy=P.y-e.y,d=Math.hypot(dx,dy)||1;
    e.x+=dx/d*e.s;e.y+=dy/d*e.s;
  });
  recoil*=.8;

  /* background */
  x.fillStyle="#7ec8ff";x.fillRect(0,0,c.width,c.height);

  /* sun */
  x.fillStyle="yellow";
  x.beginPath();x.arc(80,80,40,0,Math.PI*2);x.fill();
  x.fillStyle="#000";
  x.beginPath();x.arc(70,70,5,0,Math.PI*2);
  x.arc(90,70,5,0,Math.PI*2);x.fill();
  x.beginPath();x.arc(80,85,15,0,Math.PI);x.stroke();

  enemies.forEach(e=>{
    x.fillStyle="red";
    x.fillRect(e.x-11,e.y-11,22,22);
  });

  x.fillStyle="#0af";
  x.fillRect(P.x-14,P.y-14,28,28);

  x.save();
  x.translate(P.x,P.y);
  x.rotate(P.a);
  x.fillStyle=W[CW].name==="Joke"?"pink":"#555";
  x.fillRect(14-recoil,-3,W[CW].l,6);
  x.restore();

  kills.textContent=P.k;
  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
