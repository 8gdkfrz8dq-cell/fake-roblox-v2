<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Top-Down Shooter</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  font-family:system-ui;
}
canvas{display:block}

/* SHOP */
#shop{
  position:fixed;
  top:10px;
  right:10px;
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:8px;
  font-size:14px;
  z-index:10;
}
#shop button{
  width:100%;
  margin-top:6px;
}

/* SWITCH BUTTON */
#switchBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  padding:12px 16px;
  font-size:14px;
  background:#222;
  color:#fff;
  border:1px solid #555;
  z-index:10;
}
</style>
</head>

<body>

<div id="shop">
  <b>SHOP</b><br>
  Kills: <span id="killCount">0</span><br>
  <button onclick="buyWeapon(1)">SMG (5 kills)</button>
  <button onclick="buyWeapon(2)">Shotgun (10 kills)</button>
</div>

<button id="switchBtn">SWITCH</button>

<canvas id="game"></canvas>

<script>
/* ===== CANVAS ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

/* ===== PLAYER ===== */
const player={
  x:canvas.width/2,
  y:canvas.height/2,
  size:28,
  angle:0,
  speed:2.5,
  kills:0,
  hp:100
};

/* ===== WEAPONS ===== */
const weapons=[
  {name:"Pistol",damage:40,rate:180,length:28,unlocked:true},
  {name:"SMG",damage:15,rate:90,length:34,unlocked:false},
  {name:"Shotgun",damage:70,rate:500,length:30,unlocked:false}
];
let currentWeapon=0;
const weapon={width:6,recoil:0};

/* ===== ENEMIES ===== */
const enemies=[];
function spawnEnemy(){
  enemies.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    size:22,
    hp:40,
    speed:0.8
  });
}
for(let i=0;i<8;i++)spawnEnemy();

/* ===== INPUT ===== */
let move={x:0,y:0};
let shooting=false;

/* keyboard */
addEventListener("keydown",e=>{
  if(e.key==="w")move.y=-1;
  if(e.key==="s")move.y=1;
  if(e.key==="a")move.x=-1;
  if(e.key==="d")move.x=1;
  if(e.key==="q") switchWeapon();
});
addEventListener("keyup",e=>{
  if(e.key==="w"||e.key==="s")move.y=0;
  if(e.key==="a"||e.key==="d")move.x=0;
});

/* mouse */
addEventListener("mousemove",e=>aim(e.clientX,e.clientY));
addEventListener("mousedown",()=>{shooting=true;shoot()});
addEventListener("mouseup",()=>shooting=false);

/* touch */
let joyStart=null;
addEventListener("touchstart",e=>{
  shooting=true;
  joyStart={x:e.touches[0].clientX,y:e.touches[0].clientY};
  aim(joyStart.x,joyStart.y);
  shoot();
});
addEventListener("touchmove",e=>{
  const t=e.touches[0];
  aim(t.clientX,t.clientY);
  if(joyStart){
    const dx=t.clientX-joyStart.x;
    const dy=t.clientY-joyStart.y;
    const d=Math.hypot(dx,dy)||1;
    move.x=dx/d;
    move.y=dy/d;
  }
});
addEventListener("touchend",()=>{
  shooting=false;
  joyStart=null;
  move.x=move.y=0;
});

/* ===== AIM ===== */
function aim(x,y){
  player.angle=Math.atan2(y-player.y,x-player.x);
}

/* ===== SHOOT ===== */
function shoot(){
  if(!shooting)return;
  weapon.recoil=6;

  enemies.forEach((e,i)=>{
    const dx=e.x-player.x;
    const dy=e.y-player.y;
    const dist=Math.hypot(dx,dy);
    const a=Math.atan2(dy,dx);
    const diff=Math.abs(Math.atan2(Math.sin(a-player.angle),Math.cos(a-player.angle)));

    if(dist<180&&diff<0.3){
      e.hp-=weapons[currentWeapon].damage;
      if(e.hp<=0){
        enemies.splice(i,1);
        spawnEnemy();
        player.kills++;
        updateShop();
      }
    }
  });

  setTimeout(()=>shooting&&shoot(),weapons[currentWeapon].rate);
}

/* ===== SHOP ===== */
function buyWeapon(i){
  const cost=[0,5,10][i];
  if(weapons[i].unlocked) return;
  if(player.kills<cost) return;
  player.kills-=cost;
  weapons[i].unlocked=true;
  currentWeapon=i;
  updateShop();
}
function updateShop(){
  document.getElementById("killCount").textContent=player.kills;
}

/* ===== WEAPON SWITCHING ===== */
function switchWeapon(){
  let i=currentWeapon;
  do{
    i=(i+1)%weapons.length;
  }while(!weapons[i].unlocked);
  currentWeapon=i;
}
document.getElementById("switchBtn").addEventListener("click",switchWeapon);

/* ===== UPDATE ===== */
function update(){
  player.x+=move.x*player.speed;
  player.y+=move.y*player.speed;

  enemies.forEach(e=>{
    const dx=player.x-e.x;
    const dy=player.y-e.y;
    const d=Math.hypot(dx,dy)||1;
    e.x+=dx/d*e.speed;
    e.y+=dy/d*e.speed;
  });

  weapon.recoil*=0.8;
}

/* ===== DRAW ===== */
function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  enemies.forEach(e=>{
    ctx.fillStyle="red";
    ctx.fillRect(e.x-e.size/2,e.y-e.size/2,e.size,e.size);
  });

  ctx.fillStyle="#0af";
  ctx.fillRect(
    player.x-player.size/2,
    player.y-player.size/2,
    player.size,
    player.size
  );

  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.rotate(player.angle);
  ctx.fillStyle="#ccc";
  ctx.fillRect(
    player.size/2-weapon.recoil,
    -weapon.width/2,
    weapons[currentWeapon].length,
    weapon.width
  );
  ctx.restore();
}

/* ===== LOOP ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
